<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weather Dashboard</title>
  <link rel="stylesheet" href="assets\style.css">
</head>

<body>
  <header id="hero" class="titleWeather">Weather Dashboard</header>
  <div class="searchContainer">
    <div id="citySearch" class="searchPrompt">Search for a City:</div>
    <div class="input-group">
      <input type="text" id="cityInput" placeholder="Enter a city name">
      <button id="searchButton">Search</button>
    </div>
  </div>
  <div id="weatherResult" class="weatherResult">
    <!-- Weather data will be displayed here -->
  </div>

  <script>
    // OpenWeatherMap API key
    var apiKey = '790c21a3a3e4e9fbeed5495456bb6293';

    // Base URL for the OpenWeatherMap API
    var baseUrl = 'https://api.openweathermap.org/data/2.5/forecast';

    // Weather icon base URL
    var iconBaseUrl = 'https://openweathermap.org/img/wn/';

    // pulls searchButton, cityInput, and weatherResult IDs from the HTML
    var searchButton = document.getElementById('searchButton');
    var cityInput = document.getElementById('cityInput');
    var weatherResult = document.getElementById('weatherResult');

    // Event listener for the search button
    searchButton.addEventListener('click', getWeatherData);

    function formatDate(date) {
      var month = (date.getMonth() + 1).toString().padStart(2, '0');
      var day = date.getDate().toString().padStart(2, '0');
      var year = date.getFullYear();
      return `${month}/${day}/${year}`;
    }

    function convertMetersPerSecondToMilesPerHour(windSpeedMs) {
      return windSpeedMs * 2.23694;
    }

    function getWeatherIconUrl(iconCode) {
      return `${iconBaseUrl}${iconCode}@2x.png`;
    }

    function getWeatherData() {
      var city = cityInput.value;
      var url = `${baseUrl}?q=${city}&appid=${apiKey}`;

      fetch(url)
        .then(response => response.json())
        .then(data => {
          // Clear the weatherResult element before adding new data
          weatherResult.innerHTML = "";

          // Display weather information
          weatherResult.innerHTML += `<h2>Weather data for ${city}</h2>`;
          weatherResult.innerHTML += `<p>City: ${data.city.name}</p>`;

          var currentDate = new Date(); // Get the current date

          // Filter the forecast data for daytime forecasts
          var daytimeForecasts = data.list.filter(forecast => {
            var forecastDate = new Date(forecast.dt_txt);
            var forecastHour = forecastDate.getHours();
            return forecastHour >= 6 && forecastHour <= 18;
          });

          if (daytimeForecasts.length > 0) {
            var currentDayForecast = daytimeForecasts[0]; // Use the first daytime forecast
            var temperatureKelvin = currentDayForecast.main.temp;
            var humidity = currentDayForecast.main.humidity;
            var windSpeed = currentDayForecast.wind.speed;
            var iconCode = currentDayForecast.weather[0].icon;

            // Convert temperature from Kelvin to Fahrenheit
            var temperatureFahrenheit = (temperatureKelvin - 273.15) * 9 / 5 + 32;
            var windSpeedMph = convertMetersPerSecondToMilesPerHour(windSpeed);
            var weatherIconUrl = getWeatherIconUrl(iconCode);

            // Display weather information for the current day
            weatherResult.innerHTML += `<h2>Current Day's Weather</h2>`;
            weatherResult.innerHTML += `<p>Date: ${formatDate(currentDate)}</p>`;
            weatherResult.innerHTML += `<p>Temperature: ${temperatureFahrenheit.toFixed(2)}°F</p>`;
            weatherResult.innerHTML += `<p>Humidity: ${humidity}%</p>`;
            weatherResult.innerHTML += `<p>Wind Speed: ${windSpeedMph.toFixed(2)} mph</p>`;
            weatherResult.innerHTML += `<img src="${weatherIconUrl}" alt="Weather Icon">`;
          }

          //calculates the average temperature, humidty, and windspeed
          function calculateDailyAverages(forecasts) {
            var sumTemp = 0;
            var sumHumidity = 0;
            var sumWindSpeed = 0;

            forecasts.forEach(forecast => {
              sumTemp += forecast.main.temp;
              sumHumidity += forecast.main.humidity;
              sumWindSpeed += forecast.wind.speed;
            });

            var averageTemp = sumTemp / forecasts.length;
            var averageHumidity = sumHumidity / forecasts.length;
            var averageWindSpeed = sumWindSpeed / forecasts.length;

            return {
              temperature: averageTemp,
              humidity: averageHumidity,
              windSpeed: averageWindSpeed,
            };
          }

          // ...

          for (var key in dailyForecasts) {
            var forecasts = dailyForecasts[key]; // Get all daytime forecasts for the day
            var date = new Date(key);
            var dailyAverage = calculateDailyAverages(forecasts);
            var temperatureKelvin = dailyAverage.temperature;
            var windSpeed = dailyAverage.windSpeed;
            var iconCode = forecasts[0].weather[0].icon; // Use the first forecast for the day for the icon

            // Convert temperature from Kelvin to Fahrenheit
            var temperatureFahrenheit = (temperatureKelvin - 273.15) * 9 / 5 + 32;
            var windSpeedMph = convertMetersPerSecondToMilesPerHour(windSpeed);
            var weatherIconUrl = getWeatherIconUrl(iconCode);

            var humidity = dailyAverage.humidity;

            // Display the average forecast data for each day
            weatherResult.innerHTML += '<h2>' + formatDate(date) + '</h2>';
            weatherResult.innerHTML += '<p>Temperature: ' + temperatureFahrenheit.toFixed(2) + '°F</p>';
            weatherResult.innerHTML += '<p>Humidity: ' + humidity + '%</p>';
            weatherResult.innerHTML += '<p>Wind Speed: ' + windSpeedMph.toFixed(2) + ' mph</p>';
            weatherResult.innerHTML += `<img src="${weatherIconUrl}" alt="Weather Icon">`;
          }


          var dailyForecasts = {};

          daytimeForecasts.forEach(forecast => {
            var date = new Date(forecast.dt_txt);
            var dateKey = formatDate(date);

            // Group daytime forecasts by date
            if (!dailyForecasts[dateKey]) {
              dailyForecasts[dateKey] = [];
            }
            dailyForecasts[dateKey].push(forecast);
          });

          // Display the 5-day forecast for daytime forecasts
          for (var key in dailyForecasts) {
            var dailyForecast = dailyForecasts[key][0]; // Use the first daytime forecast for each day
            var date = new Date(key);
            var temperatureKelvin = dailyForecast.main.temp;
            var windSpeed = dailyForecast.wind.speed;
            var iconCode = dailyForecast.weather[0].icon;

            // Convert temperature from Kelvin to Fahrenheit
            var temperatureFahrenheit = (temperatureKelvin - 273.15) * 9 / 5 + 32;
            var windSpeedMph = convertMetersPerSecondToMilesPerHour(windSpeed);
            var weatherIconUrl = getWeatherIconUrl(iconCode);

            var humidity = dailyForecast.main.humidity;

            // Display the forecast data for each day
            weatherResult.innerHTML += '<h2>' + formatDate(date) + '</h2>';
            weatherResult.innerHTML += '<p>Temperature: ' + temperatureFahrenheit.toFixed(2) + '°F</p>';
            weatherResult.innerHTML += '<p>Humidity: ' + humidity + '%</p>';
            weatherResult.innerHTML += '<p>Wind Speed: ' + windSpeedMph.toFixed(2) + ' mph</p>';
            weatherResult.innerHTML += `<img src="${weatherIconUrl}" alt="Weather Icon">`;
          }
        })
        .catch(error => {
          // Handle the error and display a message
          weatherResult.innerHTML = `<p>Failed to retrieve weather data. Error: ${error.message}</p>`;
        });
    }
  </script>
</body>

</html>